{% import "CscfaCSManagerCoreBundle:Macro:form.html.twig" as formTool %}
{% trans_default_domain "CscfaCSManagerProjectBundle_view_Project_selectProject" %}

<div class="col-xs-12">
    <div class="col-xs-12 col-md-8">
        <span class="col-xs-4 col-md-3 col-lg-2">{{ "projectName"|trans }}</span>
        <span class="col-xs-8 col-md-9 col-lg-10">
            {{ formTool.ajaxField(
            	path("cscfa_cs_manager_project_ajaxSource_project_name", {"project": project.getId()}), 
            	project.getName(), 
            	(grantProjectAttribute("name", project, false, true) != true)
            	) 
            }}
        </span>

        <span class="col-xs-4 col-md-3 col-lg-2">{{ "projectSummary"|trans }}</span>
        <span class="col-xs-8 col-md-9 col-lg-10">
            {{ formTool.ajaxField(
            	path("cscfa_cs_manager_project_ajaxSource_project_summary", {"project": project.getId()}), 
            	project.getSummary(), 
            	(grantProjectAttribute("summary", project, false, true) != true)
            	) 
            }}
        </span>
    </div>
    
    <div class="col-xs-12 col-md-4">
        {% if grantProjectAttribute("status", project) %}
            <span class="col-xs-4 col-md-6 col-lg-4">{{ "projectStatus"|trans }}</span>
            <span class="col-xs-8 col-md-6 col-lg-8">
                {{ formTool.ajaxField(
                    path("cscfa_cs_manager_project_ajaxSource_project_status", {"project": project.getId()}), 
                	project.getStatus().getName(), 
                	(grantProjectAttribute("status", project, false, true) != true)
                	) 
                }}
            </span>
        {% endif %}
        
        {% if grantProjectAttribute("created", project) %}
            <span class="col-xs-4 col-md-6 col-lg-4">{{ "projectCreated"|trans }}</span>
            <span class="col-xs-8 col-md-6 col-lg-8">{{ project.getCreated().format("Y-m-d H:i:s") }}</span>
        {% endif %}
        
        {% if grantProjectAttribute("updated", project) %}
            <span class="col-xs-4 col-md-6 col-lg-4">{{ "projectUpdated.title"|trans }}</span>
            {% if project.getUpdated() %}
                <span class="col-xs-8 col-md-6 col-lg-8">{{ project.getUpdated().format("Y-m-d H:i:s") }}</span>
            {% else %}
                <span class="col-xs-8 col-md-6 col-lg-8">{{ "projectUpdated.neverUpdated"|trans }}</span>
            {% endif %}
        {% endif %}
        
        {% if grantProjectAttribute("active", project) %}
            <span class="col-xs-4 col-md-6 col-lg-4">{{ "projectActive.title"|trans }}</span>
            {% if project.isDeleted() %}
                <span class="col-xs-8 col-md-6 col-lg-8">{{ "projectActive.deleted"|trans }}</span>
            {% else %}
                <span class="col-xs-8 col-md-6 col-lg-8">{{ "projectActive.undeleted"|trans }}</span>
            {% endif %}
        {% endif %}
    </div>
</div>

{% if grantProjectAttribute("tags", project) %}
<div class="col-xs-11 cs-fieldset">
    <h4 class="cs-fieldset-head">{{ "projectTags.title"|trans }}</h4>
            
    <div class="cs-fieldset-body">
    	<div class="cs-right">
    		<div>
                {{ formTool.ajaxFieldButton(
                    path("cscfa_cs_manager_project_ajaxSource_tag_tag", {"project": project.getId()}), 
                	"ajaxAddTag"|trans, 
                	(grantProjectAttribute("tags", project, false, true) != true),
                	"cs-ajax-field-button"
                	) 
                }}
            </div>
        </div>
            
        <div class="col-xs-12">
        {% for tag in project.getTags() %}
        	{% if loop.first %}
        	<table class="table table-striped">
        		<tr>
        			<th>{{ "projectTags.headName"|trans }}</th>
        			<th>{{ "projectTags.headDesc"|trans }}</th>
        			<th>{{ "projectTags.headButn"|trans }}</th>
        		</tr>
        	{% endif %}
        		<tr>
        			<td>{{ tag.getName() }}</td>
        			<td>{{ tag.getDescription() }}</td>
        			<td class="cs-right">
        				<div>
                        {{ formTool.ajaxFieldButton(
                            path("cscfa_cs_manager_project_ajaxSource_tag_remove", {"project": project.getId(), "tag": tag.getId()}),
                        	"ajaxRemTag"|trans, 
                        	(grantProjectAttribute("tags", project, false, true) != true),
                        	"cs-ajax-field-button pull-xs-right",
                        	"btn btn-danger"
                        	) 
                        }}
                        </div>
                	</td>
        		</tr>
        	{% if loop.last %}
    		</table>
        	{% endif %}
        {% else %}
            <p>{{ "projectTags.noTags"|trans }}</p>
        {% endfor %}
        </div>
    </div>
</div>
{% endif %}

{% if grantProjectAttribute("links", project) %}
<div class="col-xs-11 cs-fieldset">
    <h4 class="cs-fieldset-head">{{ "projectLinks.title"|trans }}</h4>
    <div class="cs-fieldset-body">
        {% for link in project.getLinks() %}
            {{ dump(link) }}
        {% else %}
            <p>{{ "projectLinks.noLinks"|trans }}</p>
        {% endfor %}
    </div>
</div>
{% endif %}

{% if grantProjectAttribute("notes", project) %}
<div class="col-xs-11 cs-fieldset">
    <h4 class="cs-fieldset-head">{{ "projectNotes.title"|trans }}</h4>
    <div class="cs-fieldset-body">
        {% for notes in project.getNotes() %}
            {{ dump(notes) }}
        {% else %}
            <p>{{ "projectNotes.noNotes"|trans }}</p>
        {% endfor %}
    </div>
</div>
{% endif %}

{% javascripts '@CscfaCSManagerCoreBundle/Resources/public/js/csAjaxForm.js' %}
    <script src="{{ asset_url }}"></script>
{% endjavascripts %}
{% image '@CscfaCSManagerCoreBundle/Resources/public/image/Loader/gears100.svg' %}
    <script>
    	var ajaxFormTool = ajaxForm({
        	htmlTarget: "<div class='dialog-helper' title='{{ "ajaxFromScript.title"|trans }}'><div class='cs-center'><img src='{{ asset_url }}' alt='loading'/></div></div>",
    		submitingHtml: "<div class='dialog-helper' title='{{ "ajaxFromScript.title"|trans }}'><div class='cs-center'><img src='{{ asset_url }}' alt='loading'/></div></div>",
    		submitErrorHtml: "<p style='text-align: center;'>{{ "ajaxFromScript.errorOccured"|trans }}</p>",
    		ajaxErrorHtml: "<p style='text-align: center;'>{{ "ajaxFromScript.errorOccured"|trans }}</p>",
    		submit: function(selfRef, form, htmlTarget, firstEvent){
    			$.ajax({
    				type:form.method, 
    				data: $(form).serialize(), 
    				url:form.action,
    				beforeSend: function(){
    					$(htmlTarget).html(selfRef.submitingHtml);
    				},
    				success: function(data){
    					$(firstEvent.currentTarget).attr("value", data);
    					$(firstEvent.currentTarget).html(data+'<span class="glyphicon glyphicon-edit" aria-hidden="true"></span>');
    					$(htmlTarget).remove();
    				},
    				error: function(jqXHR, textStatus, errorThrown){
    					$(htmlTarget).html(selfRef.submitErrorHtml+jqXHR.responseText);
    				}
    			});
    		}
        });
    	ajaxFormTool.run();
    	
    	var ajaxFormToolButton = ajaxForm({
        	selector: ".cs-ajax-field-button",
        	htmlTarget: "<div class='dialog-helper' title='{{ "ajaxFromScript.title"|trans }}'><div class='cs-center'><img src='{{ asset_url }}' alt='loading'/></div></div>",
    		submitingHtml: "<div class='dialog-helper' title='{{ "ajaxFromScript.title"|trans }}'><div class='cs-center'><img src='{{ asset_url }}' alt='loading'/></div></div>",
    		submitErrorHtml: "<p style='text-align: center;'>{{ "ajaxFromScript.errorOccured"|trans }}</p>",
    		ajaxErrorHtml: "<p style='text-align: center;'>{{ "ajaxFromScript.errorOccured"|trans }}</p>",
    		submit: function(selfRef, form, htmlTarget, firstEvent){
    			$.ajax({
    				type:form.method, 
    				data: $(form).serialize(), 
    				url:form.action,
    				beforeSend: function(){
    					$(htmlTarget).html(selfRef.submitingHtml);
    				},
    				success: function(data){
    					$(htmlTarget).remove();
    					pageLoader.reload();
    				},
    				error: function(jqXHR, textStatus, errorThrown){
    					$(htmlTarget).html(selfRef.submitErrorHtml+jqXHR.responseText);
    				}
    			});
    		}
        });
    	ajaxFormToolButton.run();
    </script>
{% endimage %}
